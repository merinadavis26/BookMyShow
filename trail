import { Component, OnInit } from '@angular/core';
import { NgForm } from '@angular/forms';
import { CategoryService } from '../../services/category.service';
import { GenreService } from '../../services/genre.service';
import { MovieService } from '../../services/movie.service';

@Component({
  selector: 'app-add-movie',
  templateUrl: './add-movie.component.html',
  styleUrls: ['./add-movie.component.css']
})
export class AddMovieComponent implements OnInit {
  movie: any = {}; // Object to hold movie data
  categories: any[] = [];
  genres: any[] = [];
  themePhotoPath: string = '';

  constructor(private categoryService: CategoryService, 
              private genreService: GenreService,
              private movieService: MovieService) {}

  ngOnInit(): void {
    this.loadCategories();
    this.loadGenres();
  }

  loadCategories(): void {
    this.categoryService.getCategories().subscribe(
      categories => {
        this.categories = categories;
      },
      error => {
        console.error('Error loading categories:', error);
      }
    );
  }

  loadGenres(): void {
    this.genreService.getGenres().subscribe(
      genres => {
        this.genres = genres;
      },
      error => {
        console.error('Error loading genres:', error);
      }
    );
  }

  onSubmit(): void {
    // Add logic to handle form submission and call movieService to add movie
    this.movie.themePhotoPath = this.themePhotoPath; // Assign theme photo path to movie object
    this.movieService.addMovie(this.movie).subscribe(
      response => {
        console.log('Movie added successfully:', response);
        // Optionally, navigate to a different component or reset the form
      },
      error => {
        console.error('Error adding movie:', error);
      }
    );
  }

  onFileChange(event: any): void {
    const file = event.target.files[0];
    // Implement logic to handle file upload and extract path (themePhotoPath)
    this.themePhotoPath = 'path-to-your-uploaded-file'; // Placeholder for actual file path
  }
}
